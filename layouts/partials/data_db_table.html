{{/*
  Select and sort entries depending on which category the page belongs to
*/}}

{{ $sel_entries := slice }}
{{ if eq .Parent.Title "Home"}}
  {{ range .Sections }}
    {{ $sel_entries = $sel_entries | append .RegularPages }}
  {{ end }}
{{ else }}
  {{ $sel_entries = .RegularPages }}
{{ end }}
{{ $sel_entries_unique := $sel_entries | uniq }}
{{ $sel_entries_sorted := ($sel_entries_unique.ByParam "published").Reverse }}
{{ $paginator := .Paginate $sel_entries_sorted 10}}

{{/* TODO: selection of unique entries not working atm }}

{{/*
  Compose table title.
*/}}

{{ $composed_title := slice "Page" }}
{{ $composed_title = $composed_title | append ($paginator.PageNumber | string) }}
{{ $composed_title = $composed_title | append "out of" }}
{{ $composed_title = $composed_title | append ($paginator.TotalPages | string) }}
{{ if eq .Parent.Title "Home" }}
{{ $composed_title = $composed_title | append "in All data types" }}
{{ end }}
{{ if ne .Parent.Title "Home" }}
{{ $composed_title = $composed_title | append "in Available data >" }}
{{ $composed_title = $composed_title | append .Title }}
{{ end }}

{{ $composed_title = delimit $composed_title " "}}

<div class="alert alert-info"><i class="fas fa-exclamation-triangle"></i> Note that this dataset of available data by by researchers in Sweden is manually curated and as such may not be exhaustive. <br> If you would like to see your dataset here, please get in touch with us.</div>


<div class="container">
  <div class="row">
    {{ partial "data_db_nav.html" . }}
    <div class="col-md-10">
    <div class="row"><h5>{{ $composed_title }}</h5></div>
    <div class="row"><div class="table-responsive-md">
<table class="table table-hover table-bordered">
  <thead class="thead-light">
    <tr>
      <th scope="col">Project</th>
      <th scope="col">Last updated</th>
      <th scope="col">Available data</th>
    </tr>
  </thead>
  <tbody>
    {{ range $index, $element := $paginator.Pages }}
    <tr>
      <td><div class="row mx-0"><div class="col">
              <div class="row"><strong><a target="_blank" href="https://doi.org/{{ .Params.doi }}">{{ .Params.title }}</a></strong></div>
              <div class="row mb-1">
                <span class="text-muted">{{ with .Params.authors }}
                  {{ if gt (len .) 5}}
                  {{ range first 5 . }}
                      {{ $family := (index . "family") }}
                      {{ $initials := (index . "initials") }}
                      {{ if not $initials }} {{ $initials = substr (index . "given") 0 1 }} {{ end }}
                      {{ $family }} {{ $initials }},
                  {{ end }}
                  {{ range last 1 . }}
                      {{ $family := (index . "family") }}
                      {{ $initials := (index . "initials") }}
                      {{ if not $initials }} {{ $initials = substr (index . "given") 0 1 }} {{ end }}
                      [...], {{ $family }} {{ $initials }}
                  {{ end }}
                  {{ else }}
                  {{ $n := sub (len .) 1}}
                  {{ range first $n . }}
                      {{ $family := (index . "family") }}
                      {{ $initials := (index . "initials") }}
                      {{ if not $initials }} {{ $initials = substr (index . "given") 0 1 }} {{ end }}
                      {{ $family }} {{ $initials }},
                  {{ end }}
                  {{ range last 1 . }}
                      {{ $family := (index . "family") }}
                      {{ $initials := (index . "initials") }}
                      {{ if not $initials }} {{ $initials = substr (index . "given") 0 1 }} {{ end }}
                      {{ $family }} {{ $initials }}
                  {{ end }}
                  {{ end }}
                  {{ end }}
                </span>
          </div>
              <div class="row mb-1">{{if eq .Params.type "preprint" }} [preprint]&nbsp;{{ end}} <i>{{ .Param "journal.title" }}</i>&nbsp;<b>{{ .Param "journal.volume" }}</b>&nbsp;{{$issue_num := .Param "journal.issue"}}{{ if gt $issue_num 0 }}({{ .Param "journal.issue" }})&nbsp;{{ end }}{{ .Param "journal.article_number" }} {{ .Param "journal.pages" }}</div>
              <div class="row"><span class="text-muted">{{ .Params.doi }}</span></div>
              {{if isset .Params "abstract" }}<div class="row">
                <a class="btn btn-link text-dark" data-toggle="collapse" href="#abstract{{ $index }}" role="button" aria-expanded="false" aria-controls="abstract{{ $index }}">
                  Abstract <i class="fas fa-caret-down"></i></a>
                <div class="collapse" id="abstract{{ $index }}">
                  <div class="card card-body">{{ .Params.abstract }}</div>
                </div>
              </div>{{ end }}
            </div></div></td>
      <td>{{ .Params.published.Format "02.01.2006" }}</td>
      <td>
        {{ with .Params.data }}
        {{ if eq (len .) 1 }}
            {{ range . }}
                {{ $data_description := (index . "description") }}
                {{ $data_url := (index . "URL") }}
                {{if $data_url }}<a target="_blank" href="{{ $data_url }}">{{ $data_description }}</a>{{ else }}{{ $data_description }}{{ end }}<br>
            {{ end }}
        {{ else }}
        <ul class="pl-3">
          {{ range . }}
                {{ $data_description := (index . "description") }}
                {{ $data_url := (index . "URL") }}
                <li>{{if $data_url }}<a target="_blank" href="{{ $data_url }}">{{ $data_description }}</a>{{ else }}{{ $data_description }}{{ end }}</li>
          {{ end }}
        </ul>
        {{ end }}
        {{ end }}
      </td>
    </tr>
    {{ end }}
  </tbody>
</table></div>
<div>{{ template "_internal/pagination.html" . }}</div>
</div>

</div>
</div>
</div>
