{{ define "main" }}

{{ .Content }}

{{/*
  Select which entries from the database to display on this page
*/}}

{{ $entries_to_display := slice }}

{{ range $index, $entry := $.Site.Data.publications.publications }}
    {{ $entries_to_display = $entries_to_display | append $entry}}
{{ end }}

<div class="container">
  <div class="row">
    <div class="col-md-2 pl-0 pr-2">
      <h5>Field/Topic</h5>
      <div class="col mb-2">
          <div class="row">All ({{ len $entries_to_display }})</div>
          <div class="row">Biochemistry</div>
          <div class="row">Genomics & transcriptomics</div>
          <div class="row">Health</div>
          <div class="row">Imaging</div>
          <div class="row">Proteins</div>
          <div class="row">Serology</div>
          <div class="row">Other</div>
      </div>
      <h5>Data availability</h5>
      <div class="col mb-2">
          <div class="row">All ({{ len $entries_to_display }})</div>
          <div class="row">Data available</div>
      </div>
      <h5>Publication type</h5>
      <div class="col mb-2">
          <div class="row">All ({{ len $entries_to_display }})</div>
          <div class="row">Journal article</div>
          <div class="row">Review</div>
          <div class="row">Preprint</div>
          <div class="row">Other</div>
      </div>
      <h5>Year</h5>
      <div class="col mb-2">
          <div class="row">All ({{ len $entries_to_display }})</div>
          <div class="row">2020</div>
          <div class="row">2021</div>
      </div>
      <div class="alert alert-info small"><i class="fas fa-exclamation-triangle"></i>
        Functionality for filtering publications is currently under development.
      </div>
    </div>
    <div class="col-md-10">
          <div class="row">
            <div class="table-responsive-md">
              <table class="table">
                <thead class="thead-light">
                  <tr>
                    <th scope="col">Publication</th>
                    <th scope="col">Published/updated</th>
                  </tr>
                </thead>
                <tbody>
                  {{ range $index, $entry := $entries_to_display }}
                    <tr>
                      <td>
                        <b><a target="_blank" href="{{ if .doi }}https://doi.org/{{ .doi }}{{ else }}https://pubmed.ncbi.nlm.nih.gov/{{ .pmid }}{{ end}}">{{ .title }}</a></b><br>
                        <span class="text-muted">{{ with .authors }}
                          {{ if gt (len .) 8}}
                          {{ range first 8 . }}
                              {{ $family := (index . "family") }}
                              {{ $initials := (index . "initials") }}
                              {{ if not $initials }} {{ $initials = substr (index . "given") 0 1 }} {{ end }}
                              {{ $family }} {{ $initials }},
                          {{ end }}
                          {{ range last 1 . }}
                              {{ $family := (index . "family") }}
                              {{ $initials := (index . "initials") }}
                              {{ if not $initials }} {{ $initials = substr (index . "given") 0 1 }} {{ end }}
                              [...], {{ $family }} {{ $initials }}
                          {{ end }}
                          {{ else }}
                          {{ $n := sub (len .) 1}}
                          {{ range first $n . }}
                              {{ $family := (index . "family") }}
                              {{ $initials := (index . "initials") }}
                              {{ if not $initials }} {{ $initials = substr (index . "given") 0 1 }} {{ end }}
                              {{ $family }} {{ $initials }},
                          {{ end }}
                          {{ range last 1 . }}
                              {{ $family := (index . "family") }}
                              {{ $initials := (index . "initials") }}
                              {{ if not $initials }} {{ $initials = substr (index . "given") 0 1 }} {{ end }}
                              {{ $family }} {{ $initials }}
                          {{ end }}
                          {{ end }}
                          {{ end }}
                        </span><br>
                        {{ range $key, $content := .labels }} {{ if eq $key "Type: Preprint"}} [preprint]&nbsp;{{ end }}{{ end}} <i>{{ .journal.title }}</i>{{ if .journal.volume }}&nbsp;<b>{{ .journal.volume }}</b>{{ end }}{{if .journal.issue}}&nbsp;({{ .journal.issue }})&nbsp;{{ end }}{{ if .journal.pages }}&nbsp;{{ .journal.pages }}{{ end }}.{{ if .doi}} DOI: {{ .doi }}{{ end }}
                      </td>
                      <td>{{ .published }}</td>
                    </tr>
                  {{ end }}
                </tbody>
              </table>
            </div>
          </div>
    </div>
  </div>
</div>

<script>
$(document).ready( function () {
    $('table.table').DataTable({
      "order": [[ 1, "desc" ]],
    }

    );
} );
</script>

<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js"></script>

{{ end }}
